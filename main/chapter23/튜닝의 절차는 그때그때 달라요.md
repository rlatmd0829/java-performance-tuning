## 성능 튜닝을 위한 아주 기초 법칙

성능 튜닝을 위해서는 아주 기초적인 법칙을 하나를 알아야 한다. 바로 '암달(Amdahl)의 법칙'이라는 것이다.

Gene Amdahl이 1967년에 시스템의 성능 향상에 대한 법칙을 만들었다. 이 법칙을 간단하게 설명하자면, 1 Core에서 20시간 소요되는 작업 중 1시간은 절대 개선할 수 없다면, 20배 이상의 성능 향상은 불가능하다는 법칙이다. 

암달의 법칙을 그래프로 나타내면 다음과 같다.

![image](https://github.com/rlatmd0829/java-performance-tuning/assets/70622731/d346daf2-da5e-4455-bc45-ed2acd145560)

어떤 프로그램이라도 할지라도 위와 같은 패턴을 보일 수 밖에 없으며, 성능 개선에는 한계가 생길 수 밖에 없다.

<br>

## 성능 튜닝 step by step

1. 원인 파악
2. 목표 설정
3. 튜닝 실시
4. 개선율 확인
5. 결과 정리 및 반영

### 원인 파악
성능 저하가 발생하는 원인을 파악하는 단계이다.

이 단계에서 원인 파악을 잘못하면 매우 많은 시간 낭비가 발생할 것이다. 따라서, 어디가 병목인지 확실히 파악하여 원인을 찾아야 한다.

### 목표 설정

성능 튜닝의 목표를 설정하는 단계이다.

반드시 목표를 설정할 필요는 없다. 하지만, 모든 일은 목표가 있어야만 제대로 된 결과가 나올 수 있다. 성능 개선뿐만 아니라, 향후 유지보수까지 모두 고려해서 목표를 정하는 것이 좋다.

### 튜닝 실시

코드를 최적화하며 튜닝하는 단계이다.

튜닝을 실시하는 가장 좋은 방법은 프로파일링 툴이나 APM과 같은 툴을 사용하는 것이고, 개선이 얼마나 되었는지를 확인하려면 JMH나 캘리퍼와 같은 성능 비교 도구를 사용하는 것도 큰 도움이 될 수 있다.

### 개선율 확인

튜닝을 실시한 후 얼마나 개선되었는지를 확인하는 단계이다.

개선을 확인한 다음에, 결과가 만족스럽지 않은 경우에는 '튜닝 실시' 단계로 다시 넘어가서 진행을 해야 한다. 간혹, 원인을 잘못 판단했을 경우 개선율이 아주 낮게 나올 수 밖에 없다. 엉뚱한 곳에서 작업을 할 수도 있으니, 때에 따라서는 '원익 파악'부터 다시 해야 한다.

### 결과 정리 및 반영

튜닝한 결과들을 정리하고, 실제 운영되는 시스템에 반영하는 단계이다.

만약 정리가 반드시 필요 없다고 하더라도, 아주 간단하게 어딘가에 정리하는 습관을 가져가는 것이 좋다. 가장 좋은 것은 파워 포인트나 워드와 같은 문서지만, 이 작업을 수행할 때는 꽤 많은 시간이 소요된다. 따라서, 관련인들에게 전달할 메일로 정리하거나. 회사에 위키가 있다면 위키로 정리하는 것도 좋다.


<br>

## 성능 튜닝의 비법

- 하나만 보지 말아라.
- 큰 놈을 없애라.
- 깊게 알아야 한다.
- 결과 공유는 선택이 아닌 필수!

### 하나만 보지 말아라

- 서버장비 : CPU, Network, Disk, Memory 등
- 서버 OS : OS 커널, OS 설정, 수행중인 프로세스 등
- 자바 애플리케이션 : 스레드 풀 설정, DB Connection Pool 설정, Cache 설정, GC 설정, Heap 크기 설정, 검증되지 않은 프레임워크의 버그, 개발된 애플리케이션 등
- 웹 서버 : 프로세스 개수 설정, Connector 설정, 개발된 모듈의 버그 등
- 네트워크 : 사용자의 네트워크의 종류, 사용자의 위치, L4 및 Switch 등 네트워크 장비, 방화벽 등
- 클라이언트 : 클라이언트 장비의 CPU, Network, Disk, Memory, OS 등의 성능, 클라이언트 애플리케이션, 클라이언트 장비에서 수행 중인 프로세스 등

### 큰 놈을 없애라

애플리케이션의 가장 큰 성능 저하가 발생하는 부분을 찾아서 튜닝해야만 한다. 잔챙이 백날 튜닝해봐야 티가 안난다.

어떤 애플리케이션은 1명의 요청을 할 때는 응답이 0.1초로 매우 빠르다. 하지만, 운영 상황에서 그 속도가 나온다고 보장할 수는 없다. 즉, 부하 테스트 툴이나 간단히 스레드를 만들어서 부하를 주어 성능 측정을 해 봐야만 한다.

### 깊게 알아야 한다

개발 언어, OS, DB, N/W, 서버 등 대충 알면 대충 튜닝할 수밖에 없다. 하지만, 이 모든 것의 전문가가 되기는 어렵다. 그러니 하나라도 전문가가 되어야 한다.

### 결과 공유는 선택이 아닌 필수

결과를 잘 정리하는 것은 매우 중요하다. 잘못하면 오랜 기간 동안 힘들게 작업한 것이 인정받지 못할 수도 있다. 결과 정리를 할 때 꼭 포함되어야 하는 내용은 다음과 같다.

- 개요
- 튜닝환경
- 튜닝결과
- 결론



